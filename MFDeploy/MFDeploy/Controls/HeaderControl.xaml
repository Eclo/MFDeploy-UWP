<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MFDeploy.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:utils="using:MFDeploy.Utilities"
    xmlns:conv="using:MFDeploy.Converters"
    xmlns:views="using:MFDeploy.Views"
    x:Class="MFDeploy.Controls.HeaderControl"
    mc:Ignorable="d"
    d:DesignHeight="40"
    d:DesignWidth="400"
    >

    <UserControl.Resources>

        <DataTemplate x:Key="SerialTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 6 8 C 4.19196 8 2.77575 9.6475 3.03125 11.4375 L 4.46875 21.4375 C 4.67792 22.9092 5.95154 24 7.4375 24 L 24.5625 24 C 26.0485 24 27.3221 22.9092 27.5313 21.4375 L 28.9688 11.4375 C 29.2258 9.64722 27.808 8 26 8 L 6 8 Z M 6 10 L 26 10 C 26.628 10 27.089 10.5365 27 11.1563 L 25.5625 21.1563 C 25.4917 21.6546 25.0685 22 24.5625 22 L 7.4375 22 C 6.93146 22 6.50833 21.6546 6.4375 21.1563 L 5 11.1563 C 4.9115 10.5363 5.37204 10 6 10 Z M 8 13 C 7.44772 13 7 13.4477 7 14 C 7 14.5523 7.44772 15 8 15 C 8.55228 15 9 14.5523 9 14 C 9 13.4477 8.55228 13 8 13 Z M 12 13 C 11.4477 13 11 13.4477 11 14 C 11 14.5523 11.4477 15 12 15 C 12.5523 15 13 14.5523 13 14 C 13 13.4477 12.5523 13 12 13 Z M 16 13 C 15.4477 13 15 13.4477 15 14 C 15 14.5523 15.4477 15 16 15 C 16.5523 15 17 14.5523 17 14 C 17 13.4477 16.5523 13 16 13 Z M 20 13 C 19.4477 13 19 13.4477 19 14 C 19 14.5523 19.4477 15 20 15 C 20.5523 15 21 14.5523 21 14 C 21 13.4477 20.5523 13 20 13 Z M 24 13 C 23.4477 13 23 13.4477 23 14 C 23 14.5523 23.4477 15 24 15 C 24.5523 15 25 14.5523 25 14 C 25 13.4477 24.5523 13 24 13 Z M 10 17 C 9.44772 17 9 17.4477 9 18 C 9 18.5523 9.44772 19 10 19 C 10.5523 19 11 18.5523 11 18 C 11 17.4477 10.5523 17 10 17 Z M 14 17 C 13.4477 17 13 17.4477 13 18 C 13 18.5523 13.4477 19 14 19 C 14.5523 19 15 18.5523 15 18 C 15 17.4477 14.5523 17 14 17 Z M 18 17 C 17.4477 17 17 17.4477 17 18 C 17 18.5523 17.4477 19 18 19 C 18.5523 19 19 18.5523 19 18 C 19 17.4477 18.5523 17 18 17 Z M 22 17 C 21.4477 17 21 17.4477 21 18 C 21 18.5523 21.4477 19 22 19 C 22.5523 19 23 18.5523 23 18 C 23 17.4477 22.5523 17 22 17 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <DataTemplate x:Key="UsbTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 9 5 L 9 6 L 9 14 L 8 14 C 6.35503 14 5 15.355 5 17 L 5 27 L 7 27 L 7 17 C 7 16.435 7.43497 16 8 16 L 24 16 C 24.565 16 25 16.435 25 17 L 25 27 L 27 27 L 27 17 C 27 15.355 25.645 14 24 14 L 23 14 L 23 6 L 23 5 L 22 5 L 10 5 L 9 5 Z M 11 7 L 21 7 L 21 14 L 11 14 L 11 7 Z M 13 9 L 13 11 L 15 11 L 15 9 L 13 9 Z M 17 9 L 17 11 L 19 11 L 19 9 L 17 9 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <DataTemplate x:Key="NetworkTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 5 5 L 5 6 L 5 26 L 5 27 L 6 27 L 26 27 L 27 27 L 27 26 L 27 6 L 27 5 L 26 5 L 6 5 L 5 5 Z M 7 7 L 25 7 L 25 25 L 7 25 L 7 7 Z M 13 12 L 13 14 L 10 14 L 10 20 L 12 20 L 12 19 L 13 19 L 13 20 L 14 20 L 14 19 L 15 19 L 15 20 L 17 20 L 17 19 L 18 19 L 18 20 L 19 20 L 19 19 L 20 19 L 20 20 L 22 20 L 22 14 L 19 14 L 19 12 L 13 12 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <utils:TransportTypeTemplateSelector x:Key="TransportTypeTemplateSelector" 
                                             SerialTemplate="{StaticResource SerialTemplate}" 
    		                                 UsbTemplate="{StaticResource UsbTemplate}"
    		                                 TcpIpTemplate="{StaticResource NetworkTemplate}"/>

        <Style  x:Key="FlyoutLisBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="TabNavigation" Value="Local" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="UseSystemFocusVisuals" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Grid x:Name="LayoutRoot" Background="{TemplateBinding Background}" BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid.Resources>
                                <Style x:Key="BaseContentPresenterStyle" TargetType="ContentPresenter">
                                    <Setter Property="FontFamily" Value="XamlAutoFontFamily" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                    <Setter Property="FontSize" Value="15" />
                                    <Setter Property="TextWrapping" Value="Wrap" />
                                    <Setter Property="LineStackingStrategy" Value="MaxHeight" />
                                    <Setter Property="TextLineBounds" Value="Full" />
                                    <Setter Property="OpticalMarginAlignment" Value="TrimSideBearings" />
                                </Style>
                                <Style x:Key="BodyContentPresenterStyle" TargetType="ContentPresenter" BasedOn="{StaticResource BaseContentPresenterStyle}">
                                    <Setter Property="FontWeight" Value="Normal" />
                                    <Setter Property="FontSize" Value="15" />
                                </Style>
                            </Grid.Resources>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonHoverBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedUnfocused">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="1" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedPointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonHoverBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="1" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedPressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonPressedBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="1" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            
                            <Rectangle x:Name="PressedBackground" Fill="Transparent" Control.IsTemplateFocusTarget="True"/>
                            <StackPanel Orientation="Horizontal" 
                                        Margin="{TemplateBinding Padding}"
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                                <SymbolIcon x:Name="Glyph" Width="16" Height="16" Symbol="Accept" Opacity="0"/>
                                <ContentPresenter x:Name="ContentPresenter"
                                                    Content="{TemplateBinding Content}"
                                                    ContentTransitions="{TemplateBinding ContentTransitions}"
                                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                                    Style="{StaticResource BodyContentPresenterStyle}"
                                                    TextWrapping="NoWrap" Margin="5,0,0,0"                                                    
                                                     />
                            </StackPanel>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Converters -->
        <conv:IntToObjectConverter x:Key="IntToObjectConverter" />
        
    </UserControl.Resources>

    <UserControl.DataContext>
        <Binding Mode="OneWay" Path="MainPageViewModel" Source="{StaticResource Locator}"/>
    </UserControl.DataContext>

    <Grid Padding="0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Button x:Name="TransportTypeButton" Grid.Column="1"  Margin="10,0,10,0"                 
			    Content="{x:Bind ViewModel.SelectedTransportType, Mode=OneWay}" ContentTemplateSelector="{StaticResource TransportTypeTemplateSelector}" 
                Style="{StaticResource HeaderButtonStyle}" Height="40" Width="40" >
            <Button.Flyout>
                <Flyout x:Name="flyout" Placement="Bottom" views:AttachProp.IsOpen="False" Opened="flyout_Opened" >
                    <Flyout.FlyoutPresenterStyle>
                        <Style TargetType="FlyoutPresenter">
                            <Setter Property="Padding" Value="0" />
                        </Style>
                    </Flyout.FlyoutPresenterStyle>

                    <ListBox ItemsSource="{x:Bind ViewModel.AvailableTransportTypes}" 
                             Background="{StaticResource FlyoutBackgroundBrush}" Foreground="{StaticResource FlyoutForegroundBrush}"
						     ItemTemplateSelector="{StaticResource TransportTypeTemplateSelector}" 
						     SelectedItem="{x:Bind ViewModel.SelectedTransportType, Converter={StaticResource IntToObjectConverter}, Mode=TwoWay}"
                             SelectionChanged="ListBox_SelectionChanged" ItemContainerStyle="{StaticResource FlyoutLisBoxItemStyle}"/>
                </Flyout>
            </Button.Flyout>
        </Button>
    </Grid>
</UserControl>
